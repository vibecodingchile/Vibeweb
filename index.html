<!doctype html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>vibecodingchile | Ciberseguridad, ANCI, CSIRT, ISO 27001</title>

  <meta name="description" content="vibecodingchile: Auditoría de Ciberseguridad, Cumplimiento ANCI, CSIRT, ISO 27001 y soluciones LegalTech en Chile.">
  <meta name="keywords" content="ciberseguridad chile, ANCI, CSIRT, ISO 27001, auditoría TI, LegalTech, PASC-GOV, GRC, RAG">
  <meta name="author" content="vibecodingchile">

  <!-- SEO / Open Graph -->
  <meta property="og:title" content="vibecodingchile | Ciberseguridad & LegalTech">
  <meta property="og:description" content="Auditoría TI, cumplimiento normativo ANCI / CSIRT / ISO 27001 y plataformas GRC.">
  <meta property="og:type" content="website">

  <style>
    :root{
      --bg: #0f172a;
      --panel: #020617;
      --panel2: rgba(2,6,23,0.7);
      --text: #e5e7eb;
      --muted: rgba(229,231,235,0.78);
      --brand: #38bdf8;
      --ok: #22c55e;
      --border: rgba(229,231,235,0.14);
      --shadow: 0 10px 35px rgba(0,0,0,0.35);
      --radius: 16px;
    }

    *{ box-sizing:border-box; }
    html{ scroll-behavior:smooth; }
    body{
      margin:0;
      font-family: Arial, Helvetica, sans-serif;
      background: radial-gradient(1000px 600px at 50% -50%, rgba(56,189,248,0.18), transparent 70%),
                  radial-gradient(800px 500px at 20% 0%, rgba(34,197,94,0.12), transparent 55%),
                  var(--bg);
      color: var(--text);
      line-height: 1.6;
    }

    /* Layout */
    .container{
      max-width: 1120px;
      margin: 0 auto;
      padding: 0 20px;
    }

    header{
      padding: 64px 0 44px;
      background: linear-gradient(135deg, rgba(2,6,23,0.95), rgba(15,23,42,0.95));
      border-bottom: 1px solid var(--border);
    }
    .hero{
      display:grid;
      grid-template-columns: 1.2fr 0.8fr;
      gap: 24px;
      align-items:center;
    }
    .badge{
      display:inline-flex;
      gap:10px;
      align-items:center;
      padding: 8px 12px;
      border: 1px solid rgba(56,189,248,0.25);
      background: rgba(56,189,248,0.10);
      border-radius: 999px;
      color: var(--text);
      font-weight: bold;
      font-size: 0.9rem;
      width: fit-content;
    }
    .badge span{
      color: var(--brand);
    }
    h1{
      margin: 14px 0 10px;
      font-size: 2.4rem;
      color: var(--brand);
      line-height: 1.15;
    }
    .subtitle{
      margin: 0 0 18px;
      color: var(--muted);
      font-size: 1.02rem;
    }
    .cta-row{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      margin-top: 14px;
    }

    nav{
      position: sticky;
      top: 0;
      z-index: 100;
      backdrop-filter: blur(10px);
      background: rgba(2,6,23,0.85);
      border-bottom: 1px solid var(--border);
    }
    .nav-inner{
      display:flex;
      justify-content: space-between;
      align-items:center;
      padding: 12px 0;
      gap: 14px;
      flex-wrap:wrap;
    }
    .brand-mini{
      font-weight:bold;
      color: var(--text);
      text-decoration:none;
    }
    .nav-links{
      display:flex;
      gap: 18px;
      flex-wrap:wrap;
      justify-content:center;
      align-items:center;
    }
    .nav-links a{
      color: var(--text);
      text-decoration:none;
      font-weight:bold;
      opacity: 0.9;
    }
    .nav-links a:hover{ color: var(--brand); opacity:1; }

    section{
      padding: 54px 0;
    }
    h2{
      margin: 0 0 14px;
      font-size: 1.65rem;
    }
    .lead{
      margin: 0 0 18px;
      color: var(--muted);
    }

    /* Cards & grids */
    .grid{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 18px;
    }
    .card{
      background: rgba(2,6,23,0.95);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 18px;
      box-shadow: var(--shadow);
    }
    .card h3{ margin: 0 0 8px; }
    .card p{ margin: 0; color: var(--muted); }
    .pill{
      display:inline-block;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(229,231,235,0.14);
      background: rgba(229,231,235,0.06);
      color: var(--text);
      font-size: 0.85rem;
      margin-bottom: 10px;
    }

    /* Buttons */
    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      padding: 12px 16px;
      border-radius: 14px;
      text-decoration:none;
      font-weight: bold;
      border: 1px solid rgba(56,189,248,0.35);
      background: rgba(56,189,248,0.12);
      color: var(--text);
      transition: transform .12s ease, background .12s ease, border-color .12s ease, opacity .12s ease;
      cursor:pointer;
      user-select:none;
    }
    .btn:hover{
      transform: translateY(-1px);
      background: rgba(56,189,248,0.18);
      border-color: rgba(56,189,248,0.55);
    }
    .btn.secondary{
      border-color: rgba(34,197,94,0.35);
      background: rgba(34,197,94,0.10);
    }
    .btn.secondary:hover{
      background: rgba(34,197,94,0.16);
      border-color: rgba(34,197,94,0.55);
    }
    .btn.ghost{
      border-color: rgba(229,231,235,0.16);
      background: rgba(229,231,235,0.06);
    }
    .btn.ghost:hover{
      background: rgba(229,231,235,0.10);
      border-color: rgba(229,231,235,0.26);
    }

    /* Demo */
    .demo-wrap{
      border: 1px solid rgba(229,231,235,0.18);
      border-radius: var(--radius);
      overflow:hidden;
      height: 78vh;
      background: #000;
    }
    .demo-wrap iframe{ width:100%; height:100%; border:0; }

    /* IA assistant */
    .assistant{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 18px;
      align-items:start;
    }
    .assistant .panel{
      background: rgba(2,6,23,0.95);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .assistant .panel-header{
      padding: 14px 16px;
      border-bottom: 1px solid var(--border);
      display:flex;
      justify-content: space-between;
      align-items:center;
      gap: 12px;
      background: linear-gradient(135deg, rgba(56,189,248,0.10), rgba(34,197,94,0.08));
    }
    .assistant .panel-header strong{
      display:flex;
      align-items:center;
      gap:10px;
    }
    .dot{
      width:10px;height:10px;border-radius:999px;background: var(--ok);
      box-shadow: 0 0 14px rgba(34,197,94,0.55);
    }
    .assistant .chat{
      padding: 14px 16px;
      height: 310px;
      overflow-y:auto;
      background: rgba(0,0,0,0.25);
    }
    .msg{
      margin: 0 0 10px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(229,231,235,0.12);
      background: rgba(2,6,23,0.75);
      color: var(--text);
      max-width: 95%;
    }
    .msg.user{
      margin-left:auto;
      border-color: rgba(56,189,248,0.22);
      background: rgba(56,189,248,0.08);
    }
    .msg.ai{
      border-color: rgba(34,197,94,0.22);
      background: rgba(34,197,94,0.06);
      color: var(--text);
    }
    .assistant .controls{
      border-top: 1px solid var(--border);
      padding: 12px;
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      background: rgba(2,6,23,0.90);
    }
    .assistant input{
      flex: 1;
      min-width: 220px;
      padding: 12px 12px;
      border-radius: 12px;
      border: 1px solid rgba(229,231,235,0.16);
      background: rgba(2,6,23,0.65);
      color: var(--text);
      outline:none;
    }
    .quick{
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      padding: 14px 16px;
    }
    .quick button{
      border: 1px solid rgba(229,231,235,0.16);
      background: rgba(229,231,235,0.06);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 14px;
      cursor:pointer;
      font-weight:bold;
    }
    .quick button:hover{
      border-color: rgba(56,189,248,0.35);
      background: rgba(56,189,248,0.10);
    }
    .note{
      font-size: 0.92rem;
      color: var(--muted);
      margin-top: 10px;
    }

    footer{
      padding: 28px 0 40px;
      border-top: 1px solid var(--border);
      background: rgba(2,6,23,0.75);
    }
    footer a{ color: var(--brand); text-decoration:none; font-weight:bold; }
    footer a:hover{ text-decoration:underline; }

    /* Responsive */
    @media (max-width: 980px){
      .hero{ grid-template-columns: 1fr; }
      .grid{ grid-template-columns: 1fr; }
      .assistant{ grid-template-columns: 1fr; }
      h1{ font-size: 2.05rem; }
    }
  </style>
</head>

<body>

<header>
  <div class="container hero">
    <div>
      <div class="badge"><span>vibecodingchile</span> · Ciberseguridad & LegalTech</div>
      <h1>Auditoría, cumplimiento y plataformas GRC para entornos críticos</h1>
      <p class="subtitle">
        Integramos derecho y tecnología para reducir riesgo legal/técnico, fortalecer seguridad operacional y
        generar evidencia trazable para auditorías.
      </p>

      <div class="cta-row">
        <a class="btn secondary" href="https://wa.me/56921705486" target="_blank" rel="noopener noreferrer">
          WhatsApp +56 9 29648142
        </a>
        <a class="btn" href="mailto:contacto@vibecodingchile.com">contacto@vibecodingchile.com</a>
        <a class="btn ghost" href="#demo">Ver demo</a>
      </div>

      <p class="note">Operación alineada a Ley 19.628, GDPR, ANCI y CSIRT.</p>
    </div>

    <div class="card">
      <div class="pill">PASC · Evidencia · Trazabilidad</div>
      <p style="margin:0 0 12px; color: var(--muted);">
        Suite orientada a fiscalización, control y auditoría con foco en cumplimiento y respuesta a incidentes.
      </p>
      <div style="display:flex; gap:14px; flex-wrap:wrap; justify-content:center; margin-top:10px;">
        <img src="pasc-gov-1.png" alt="PASC-GOV Seguridad" style="max-height:115px; opacity:0.95;">
        <img src="pasc-gov-2.png" alt="PASC-GOV Análisis" style="max-height:102px; opacity:0.95;">
        <img src="pasc-gov-3.png" alt="PASC-GOV Institucional" style="max-height:115px; opacity:0.95;">
      </div>
    </div>
  </div>
</header>

<nav>
  <div class="container nav-inner">
    <a class="brand-mini" href="#top">vibecodingchile</a>
    <div class="nav-links">
      <a href="#servicios">Servicios</a>
      <a href="#plataformas">Plataformas</a>
      <a href="#asistente">Asistente IA</a>
      <a href="#demo">Demo</a>
      <a href="#contacto">Contacto</a>
      <a href="#legal">Legal</a>
    </div>
  </div>
</nav>

<main id="top">

  <section id="servicios">
    <div class="container">
      <h2>Servicios y Cumplimiento</h2>
      <p class="lead">
        Entregamos implementación, auditoría y soporte operativo con enfoque de evidencia y trazabilidad.
      </p>

      <div class="grid">
        <div class="card">
          <div class="pill">ANCI & CSIRT</div>
          <h3>Gestión de incidentes y controles</h3>
          <p>
            Diseño de controles, planes de respuesta, gestión de incidentes, registro de evidencia y alineación a estrategia y exigencias.
          </p>
        </div>

        <div class="card">
          <div class="pill">ISO/IEC 27001</div>
          <h3>SGSI, riesgos y auditoría</h3>
          <p>
            Implementación de SGSI, análisis de riesgos, políticas, auditorías internas, planes de tratamiento y evidencia trazable.
          </p>
        </div>

        <div class="card">
          <div class="pill">Auditoría TI & GRC</div>
          <h3>Gobernanza y control</h3>
          <p>
            Auditoría técnica y documental, fortalecimiento de controles, matriz de cumplimiento y preparación para fiscalización.
          </p>
        </div>
      </div>
    </div>
  </section>

  <section id="plataformas">
    <div class="container">
      <h2>Plataformas y desarrollos</h2>
      <p class="lead">
        Construimos plataformas para institucionalizar control, evidencia digital y cumplimiento continuo.
      </p>

      <div class="grid">
        <div class="card">
          <div class="pill">PASC-GOV</div>
          <h3>Estado / Organismos públicos</h3>
          <p>
            Orientada a auditoría de servicios, evidencia digital, trazabilidad y cumplimiento regulatorio en entornos institucionales críticos.
          </p>
        </div>

        <div class="card">
          <div class="pill">PASC-Enterprise</div>
          <h3>Empresas críticas</h3>
          <p>
            Continuidad operacional, gestión de riesgos TI, controles auditables y cumplimiento avanzado para operación y proveedores.
          </p>
        </div>

        <div class="card">
          <div class="pill">Arquitectura RAG</div>
          <h3>IA Legal & Ciberseguridad</h3>
          <p>
            Respuestas contextualizadas y auditables con fuentes normativas (ANCI, CSIRT, ISO 27001) y repositorio de evidencias PASC.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- ASISTENTE IA -->
  <section id="asistente">
    <div class="container">
      <h2>Asistente IA (Automático)</h2>
      <p class="lead">
        Este asistente responde de forma automática sobre nuestros servicios, plataformas y cómo iniciar un proyecto.
        (Funciona 100% en GitHub Pages: sin backend, sin claves, sin dependencias).
      </p>

      <div class="assistant">
        <div class="panel">
          <div class="panel-header">
            <strong><span class="dot"></span>Asistente vibecodingchile</strong>
            <a class="btn ghost" style="padding:8px 12px; border-radius:12px;" href="https://wa.me/56921705486" target="_blank" rel="noopener noreferrer">
              WhatsApp
            </a>
          </div>

          <div id="chat" class="chat" aria-live="polite" aria-label="Chat del asistente">
            <!-- messages inserted by JS -->
          </div>

          <div class="controls">
            <input id="msg" type="text" placeholder="Escribe: 'ANCI', 'ISO 27001', 'PASC', 'precios', 'proceso', 'demo'..." />
            <button class="btn secondary" id="sendBtn" type="button">Enviar</button>
          </div>
        </div>

        <div class="panel">
          <div class="panel-header">
            <strong>Atajos</strong>
            <button class="btn ghost" style="padding:8px 12px; border-radius:12px;" type="button" id="resetBtn">Reiniciar</button>
          </div>

          <div class="quick">
            <button type="button" data-q="¿Qué hacen en ANCI y CSIRT?">ANCI / CSIRT</button>
            <button type="button" data-q="¿Cómo implementan ISO 27001?">ISO 27001</button>
            <button type="button" data-q="Cuéntame sobre PASC-GOV y evidencia">PASC-GOV</button>
            <button type="button" data-q="¿Qué es la arquitectura RAG?">RAG</button>
            <button type="button" data-q="¿Cuál es el proceso para contratar?">Proceso</button>
            <button type="button" data-q="¿Pueden dar un estimado de costos?">Costos</button>
            <button type="button" data-q="Quiero ver la demo">Demo</button>
            <button type="button" data-q="Necesito contacto por WhatsApp o correo">Contacto</button>
          </div>

          <div style="padding: 0 16px 16px;">
            <div class="card" style="box-shadow:none;">
              <div class="pill">Contacto directo</div>
              <p style="margin:0 0 10px;">
                WhatsApp: <a href="https://wa.me/56921705486" target="_blank" rel="noopener noreferrer" style="color:var(--brand); font-weight:bold; text-decoration:none;">+56 9 2170 5486</a><br/>
                Correo: <a href="mailto:contacto@vibecodingchile.com" style="color:var(--brand); font-weight:bold; text-decoration:none;">contacto@vibecodingchile.com</a>
              </p>
              <p style="margin:0; color:var(--muted); font-size:0.92rem;">
                Si requieres auditoría ofensiva o pentest, se trabaja con RoE (Rules of Engagement) formal y autorización previa.
              </p>
            </div>
          </div>
        </div>
      </div>

      <p class="note">
        ¿Quieres “IA real” con documentos? Se puede conectar a un backend (FastAPI) + Vector DB (Qdrant/Chroma) y fuentes normativas,
        manteniendo trazabilidad y evidencia. Esta versión está pensada para funcionar estática en GitHub Pages.
      </p>
    </div>
  </section>

  <!-- DEMO -->
  <section id="demo">
    <div class="container">
      <h2>Demo – ClaraData Domo</h2>
      <p class="lead">
        Si tu navegador bloquea la integración embebida, abre la demo en una nueva pestaña.
      </p>

      <div class="cta-row" style="margin-bottom: 12px;">
        <a class="btn secondary" href="https://claradatadomo.onrender.com/" target="_blank" rel="noopener noreferrer">
          Abrir demo en nueva pestaña
        </a>
        <a class="btn ghost" href="#contacto">Hablar por WhatsApp</a>
      </div>

      <div class="card" style="margin-bottom: 16px;">
        <strong>Nota:</strong> Algunas plataformas bloquean ser embebidas por seguridad (CSP/X-Frame-Options).
        Si ves un cuadro vacío o un error, usa el botón “Abrir demo en nueva pestaña”.
      </div>

      <div class="demo-wrap" aria-label="Demo embebida ClaraData Domo">
        <iframe
          src="https://claradatadomo.onrender.com/"
          loading="lazy"
          referrerpolicy="no-referrer"
          title="ClaraData Domo Demo">
        </iframe>
      </div>
    </div>
  </section>

  <section id="contacto">
    <div class="container">
      <h2>Contacto</h2>
      <p class="lead">Escríbenos para diagnóstico, auditoría, implementación o despliegue institucional.</p>

      <div class="grid">
        <div class="card">
          <div class="pill">WhatsApp</div>
          <h3>Respuesta rápida</h3>
          <p style="margin-bottom:12px;">Coordinación de reunión, levantamiento y alcance.</p>
          <a class="btn secondary" href="https://wa.me/56921705486" target="_blank" rel="noopener noreferrer">
            Escribir a WhatsApp
          </a>
        </div>

        <div class="card">
          <div class="pill">Correo institucional</div>
          <h3>Propuestas y documentación</h3>
          <p style="margin-bottom:12px;">Ideal para enviar antecedentes, RFP o requerimientos.</p>
          <a class="btn" href="mailto:contacto@vibecodingchile.com">
            contacto@vibecodingchile.com
          </a>
        </div>

        <div class="card">
          <div class="pill">Cumplimiento</div>
          <h3>Marco regulatorio</h3>
          <p>Operación alineada a Ley 19.628, GDPR, ANCI y CSIRT. Evidencia trazable y control documental.</p>
        </div>
      </div>
    </div>
  </section>

  <section id="legal">
    <div class="container">
      <h2>Política de Privacidad y Términos de Uso</h2>

      <div class="grid">
        <div class="card">
          <div class="pill">Política de Privacidad</div>
          <p><strong>Responsable del tratamiento:</strong> vibecodingchile<br>
            <strong>Correo de contacto:</strong> contacto@vibecodingchile.com</p>
          <p><strong>Marco normativo aplicable:</strong> Ley N°19.628 (Chile) y Reglamento (UE) 2016/679 (GDPR).</p>
          <p><strong>Datos tratados:</strong> Identificación y contacto, información profesional/técnica y metadatos necesarios para prestación de servicios.</p>
          <p><strong>Finalidad:</strong> gestión de comunicaciones, ejecución de servicios, cumplimiento de obligaciones legales y generación de evidencia técnica/documental asociada a plataformas PASC.</p>
          <p><strong>Derechos:</strong> acceso, rectificación, supresión, oposición, limitación y portabilidad vía correo institucional.</p>
        </div>

        <div class="card">
          <div class="pill">Términos y Condiciones</div>
          <p>El acceso y utilización de sitios web, plataformas y servicios 
          <!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>vibecodingchile | VibePredict Notebook</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { background-color: #0d0d0d; color: #e0e0e0; }
        .ccu-green { color: #00e676; }
        .ccu-bg-green { background-color: #00e676; }
        .glass { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }
    </style>
</head>
<body class="p-5 font-sans">
    <header class="flex justify-between items-center mb-8">
        <h1 class="text-3xl font-bold italic">vibecodingchile <span class="ccu-green">VibePredict</span></h1>
        <input type="password" id="apiKey" placeholder="Ingresa API Key aquí" class="bg-gray-900 border border-gray-700 rounded px-3 py-1 text-sm outline-none focus:border-green-500">
    </header>

    <main class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="glass p-6 rounded-2xl md:col-span-3 mb-4">
            <h2 class="text-xl mb-4 font-semibold ccu-green">Predicción de Quiebre de Stock (Demo)</h2>
            <div class="h-[250px] w-full"><canvas id="predictionChart"></canvas></div>
        </div>

        <div class="glass p-6 rounded-2xl">
            <h2 class="text-xl mb-4 font-semibold">1. Contexto Comercial</h2>
            <div class="text-sm p-4 bg-gray-900 rounded border-l-4 border-green-500 text-gray-300">
                <p><b>Archivo cargado:</b> ventas_febrero_2026.csv</p>
                <p class="mt-2"><b>Productos Top:</b> Cerveza Escudo, Pepsi 1.5L, Cristal.</p>
                <p class="mt-2"><b>Alerta:</b> Temperatura proyectada 32°C para el sábado en Santiago.</p>
            </div>
        </div>

        <div class="md:col-span-2 glass p-6 rounded-2xl flex flex-col h-[400px]">
            <h2 class="text-xl mb-4 font-semibold">2. Consultar al Motor VibePredict</h2>
            <div id="chat-box" class="flex-1 overflow-y-auto space-y-4 mb-4 p-2 text-sm">
                <div class="bg-gray-800 p-3 rounded-lg self-start max-w-[80%] text-green-400">
                    <b>VibePredict:</b> Sistema en línea. Analizando historial de Mi Carro CCU. ¿Qué necesitas predecir, Jefe?
                </div>
            </div>
            <div class="flex gap-2">
                <input type="text" id="userInput" class="flex-1 bg-gray-900 border border-gray-700 rounded-lg p-3 outline-none focus:border-green-500" placeholder="Ej: ¿Qué sugieres que pida la botillería 'El Sol' para este fin de semana?">
                <button onclick="askAI()" class="ccu-bg-green text-black font-bold px-6 rounded-lg hover:brightness-110 transition">Predecir</button>
            </div>
        </div>
    </main>

    <script>
        // Configuración del Gráfico
        const ctx = document.getElementById('predictionChart').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Lun', 'Mar', 'Mie', 'Jue', 'Vie', 'Sab', 'Dom'],
                datasets: [{
                    label: 'Stock en Local (Proyectado)',
                    data: [80, 75, 60, 40, 15, 5, 0], // Cae a cero el finde
                    borderColor: '#ff5252', tension: 0.4
                }, {
                    label: 'Stock Sugerido por VibePredict',
                    data: [80, 75, 60, 90, 120, 110, 85], // El pedido inteligente salva el stock
                    borderColor: '#00e676', backgroundColor: 'rgba(0, 230, 118, 0.1)', fill: true, tension: 0.4
                }]
            },
            options: { responsive: true, maintainAspectRatio: false, scales: { y: { grid: { color: '#333' } }, x: { grid: { color: '#333' } } } }
        });

        // Lógica de conexión a la IA (Gemini API)
        async function askAI() {
            const input = document.getElementById('userInput').value;
            const apiKey = document.getElementById('apiKey').value;
            const chatBox = document.getElementById('chat-box');
            
            if (!apiKey) { alert("¡Jefe, necesitas ingresar la API Key arriba a la derecha!"); return; }
            if (!input) return;

            // Mostrar pregunta del usuario
            chatBox.innerHTML += `<div class="bg-gray-700 p-3 rounded-lg self-end text-right ml-auto max-w-[80%]"><b>Tú:</b> ${input}</div>`;
            document.getElementById('userInput').value = '';
            chatBox.innerHTML += `<div id="loading" class="text-gray-500 text-xs italic">VibePredict está pensando...</div>`;
            chatBox.scrollTop = chatBox.scrollHeight;

            // Prompt maestro (System Instructions ocultas)
            const systemPrompt = "Eres VibePredict, una IA predictiva para clientes B2B de CCU. Responde de forma técnica, concisa y enfócate en evitar quiebres de stock. Menciona datos como el clima o tendencias de fin de semana. El usuario te pregunta: " + input;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: systemPrompt }] }] })
                });
                
                const data = await response.json();
                document.getElementById('loading').remove();
                
                const aiResponse = data.candidates[0].content.parts[0].text;
                // Mostrar respuesta de la IA
                chatBox.innerHTML += `<div class="bg-gray-800 border border-green-500 p-3 rounded-lg self-start max-w-[80%] text-green-300"><b>VibePredict:</b> ${aiResponse}</div>`;
                chatBox.scrollTop = chatBox.scrollHeight;
            } catch (error) {
                document.getElementById('loading').remove();
                chatBox.innerHTML += `<div class="text-red-500">Error de conexión. Revisa la API Key.</div>`;
            }
        }
    </script>
<script>
    // Configuración del Gráfico
    const ctx = document.getElementById('predictionChart').getContext('2d');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['Lun', 'Mar', 'Mie', 'Jue', 'Vie', 'Sab', 'Dom'],
            datasets: [{
                label: 'Stock en Local (Proyectado)',
                data: [80, 75, 60, 40, 15, 5, 0],
                borderColor: '#ff5252', tension: 0.4
            }, {
                label: 'Stock Sugerido por VibePredict',
                data: [80, 75, 60, 90, 120, 110, 85],
                borderColor: '#00e676', backgroundColor: 'rgba(0, 230, 118, 0.1)', fill: true, tension: 0.4
            }]
        },
        options: { responsive: true, maintainAspectRatio: false, scales: { y: { grid: { color: '#333' } }, x: { grid: { color: '#333' } } } }
    });

    // Lógica de conexión a la IA (Actualizada a Gemini 1.5)
    async function askAI() {
        const input = document.getElementById('userInput').value;
        // .trim() elimina espacios en blanco accidentales al copiar la clave
        const apiKey = document.getElementById('apiKey').value.trim(); 
        const chatBox = document.getElementById('chat-box');
        
        if (!apiKey) { alert("¡Jefe, necesitas ingresar la API Key arriba!"); return; }
        if (!input) return;

        // Mostrar pregunta del usuario
        chatBox.innerHTML += `<div class="bg-gray-700 p-3 rounded-lg self-end text-right ml-auto max-w-[80%]"><b>Tú:</b> ${input}</div>`;
        document.getElementById('userInput').value = '';
        
        const loadingId = 'loading-' + Date.now();
        chatBox.innerHTML += `<div id="${loadingId}" class="text-gray-500 text-xs italic">VibePredict está procesando datos de CCU...</div>`;
        chatBox.scrollTop = chatBox.scrollHeight;

        const systemPrompt = "Eres VibePredict, IA de vibecodingchile para CCU. Responde muy corto, técnico y enfocado en stock B2B. Pregunta: " + input;

        try {
            // Usamos el modelo más nuevo: gemini-1.5-flash
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`;
            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ contents: [{ parts: [{ text: systemPrompt }] }] })
            });
            
            const data = await response.json();
            document.getElementById(loadingId).remove();
            
            // Si hay un error con la API key, lo mostramos
            if (data.error) {
                console.error(data.error);
                chatBox.innerHTML += `<div class="text-red-400 p-2 text-xs">Error de API: ${data.error.message}</div>`;
                return;
            }

            const aiResponse = data.candidates[0].content.parts[0].text;
            chatBox.innerHTML += `<div class="bg-gray-800 border border-green-500 p-3 rounded-lg self-start max-w-[80%] text-green-300"><b>VibePredict:</b> ${aiResponse}</div>`;
            chatBox.scrollTop = chatBox.scrollHeight;
        } catch (error) {
            console.error(error);
            document.getElementById(loadingId).remove();
            chatBox.innerHTML += `<div class="text-red-500 p-2 text-xs">Error de conexión. Revisa que no haya espacios en tu API Key.</div>`;
        }
    }
</script>
